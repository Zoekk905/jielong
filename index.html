<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<title>微信接龙自动分组</title>
<style>
*{box-sizing:border-box;}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","PingFang SC","Microsoft YaHei",Arial;
  background:#f6f7f9;
  color:#222;
}

.wrap{
  max-width:1100px;
  margin:24px auto;
  padding:0 16px;
}

h1{
  font-size:22px;
  margin:0 0 6px;
}

.sub{
  color:#555;
  font-size:13px;
  margin-bottom:14px;
}

.card{
  background:#fff;
  border:1px solid #ddd;
  border-radius:8px;
  padding:16px;          /* ⭐统一内边距 */
  margin-bottom:14px;
}

textarea{
  width:100%;
  min-height:220px;
  box-sizing:border-box; /* ⭐关键 */
  padding:12px 14px;    /* ⭐左右/上下平衡 */
  border-radius:6px;
  border:1px solid #ccc;
  font-size:14px;
  line-height:1.6;
  resize:vertical;
  background:#fff;
  outline:none;
}

textarea:focus{
  border-color:#4c8bf5;
}

.row{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  align-items:center;
  margin-top:12px;
}

button{
  padding:7px 14px;
  border-radius:6px;
  border:1px solid #4c8bf5;
  background:#4c8bf5;
  color:#fff;
  font-weight:600;
  cursor:pointer;
}

button.secondary{
  background:#fff;
  color:#333;
  border:1px solid #ccc;
}

label{
  font-size:13px;
  color:#444;
  display:flex;
  align-items:center;
  gap:6px;
}

input[type="number"]{
  width:110px;
  padding:6px 8px;
  border-radius:6px;
  border:1px solid #ccc;
}

.groups{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
  gap:12px;
}

.gcard{
  border:1px solid #ddd;
  border-radius:8px;
  background:#fff;
}

.ghead{
  background:#f3f3f3;
  border-bottom:1px solid #ddd;
  padding:8px 10px;
  display:flex;
  justify-content:space-between;
  font-size:13px;
}

table{
  width:100%;
  border-collapse:collapse;
}

th,td{
  border:1px solid #ddd;
  padding:7px 9px;
  font-size:14px;
}

th{
  background:#f6f6f6;
  text-align:left;
}

td.num,th.num{
  text-align:right;
  width:100px;
}

td.seq,th.seq{
  text-align:right;
  width:70px;
  color:#666;
}

.ok{color:#2e8b57;}
.warn{color:#c0392b;}
</style>
</head>

<body>
<div class="wrap">
  <h1>微信接龙自动分组</h1>
  <div class="sub">
    粘贴接龙 → 自动解析 → 只显示分组结果（不拆分任何人金额）
  </div>

  <div class="card">
    <textarea id="raw" placeholder="1. 张三 100
2. 李四 20
3. 王五 50"></textarea>

    <div class="row">
      <label>每组金额
        <input id="target" type="number" value="500">
      </label>
      <label>最多补齐人数
        <input id="maxK" type="number" value="6">
      </label>
      <label>
        <input id="showSeq" type="checkbox" checked>
        显示原序号
      </label>
      <button onclick="run()">分组</button>
      <button class="secondary" onclick="clearAll()">清空</button>
    </div>
  </div>

  <div class="card">
    <strong>分组结果</strong>
    <div id="groups" style="margin-top:10px;"></div>
  </div>
</div>

<script>
function parseItems(text){
  const lines=text.replace(/\r/g,"")
    .replace(/(\d+)[\.\、]/g,"\n$1.")
    .split("\n")
    .map(s=>s.trim())
    .filter(Boolean);

  let seq=1;
  const items=[];
  for(let l of lines){
    let m=l.match(/^(\d+)\.\s*/);
    let no=m?parseInt(m[1]):seq;
    if(m) l=l.replace(/^(\d+)\.\s*/,"");
    let a=l.match(/(\d+)(?!.*\d)/);
    if(!a) continue;
    let amount=parseInt(a[1]);
    let id=l.replace(a[1],"").trim();
    items.push({no,id,amount});
    seq=no+1;
  }
  return items;
}

function findCombo(arr,need,k,start=0,path=[]){
  if(need===0&&path.length===k) return path;
  if(path.length>=k) return null;
  for(let i=start;i<arr.length;i++){
    if(arr[i].amount<=need){
      let r=findCombo(arr,need-arr[i].amount,k,i+1,[...path,i]);
      if(r) return r;
    }
  }
  return null;
}

function run(){
  const raw=document.getElementById("raw").value;
  let arr=parseItems(raw);
  const target=+document.getElementById("target").value;
  const maxK=+document.getElementById("maxK").value;
  const showSeq=document.getElementById("showSeq").checked;

  const groups=[];
  while(arr.length){
    let g=[],sum=0;
    while(arr.length && sum+arr[0].amount<=target){
      g.push(arr.shift());
      sum+=g[g.length-1].amount;
    }
    if(sum<target){
      let need=target-sum;
      for(let k=1;k<=maxK;k++){
        let c=findCombo(arr,need,k);
        if(c){
          c.sort((a,b)=>b-a).forEach(i=>g.push(arr.splice(i,1)[0]));
          sum=target;
          break;
        }
      }
    }
    groups.push({sum,items:g});
  }

  render(groups,showSeq,target);
}

function render(groups,showSeq,target){
  let html='<div class="groups">';
  groups.forEach((g,i)=>{
    html+=`
    <div class="gcard">
      <div class="ghead">
        <strong>第 ${i+1} 组</strong>
        <span class="${g.sum===target?'ok':'warn'}">合计 ${g.sum}</span>
      </div>
      <table>
        <tr>${showSeq?'<th class="seq">序号</th>':''}<th>ID</th><th class="num">金额</th></tr>
        ${g.items.map(it=>`
          <tr>
            ${showSeq?`<td class="seq">${it.no}</td>`:''}
            <td>${it.id}</td>
            <td class="num">${it.amount}</td>
          </tr>`).join("")}
      </table>
    </div>`;
  });
  html+='</div>';
  document.getElementById("groups").innerHTML=html;
}

function clearAll(){
  document.getElementById("raw").value="";
  document.getElementById("groups").innerHTML="";
}
</script>
</body>
</html>
